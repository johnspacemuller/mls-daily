<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MLS Publishing Rhythms</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #f8f9fb;
    --card: #ffffff;
    --card-border: #e8eaef;
    --text: #334155;
    --text-muted: #7c8694;
    --text-dim: #a1aab5;
    --heading: #1a2332;
    --accent: #6929c4;
    --accent-light: #f0e8ff;
    --blue: #1192e8;
    --teal: #005d5d;
    --amber: #fa4d56;
    --rose: #9f1853;
    --violet: #6929c4;
    --slate: #cbd5e1;
    --green: #198038;
    --green-light: #defbe6;
    --amber-light: #fff1f1;
    --rose-light: #fff0f6;
    --radius: 12px;
    --shadow: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    background: var(--bg); color: var(--text);
    padding: 36px 28px; line-height: 1.5;
    -webkit-font-smoothing: antialiased;
  }
  .container { max-width: 1080px; margin: 0 auto; }

  .header { margin-bottom: 28px; display: flex; align-items: baseline; gap: 12px; flex-wrap: wrap; }
  .header h1 { font-size: 22px; font-weight: 700; color: var(--heading); letter-spacing: -0.4px; }
  .header .meta { font-size: 12px; color: var(--text-muted); padding-top: 2px; }

  .kpi-strip { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px; }
  .kpi {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: var(--radius); padding: 16px 18px; box-shadow: var(--shadow);
  }
  .kpi .label { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
  .kpi .value { font-size: 28px; font-weight: 700; color: var(--heading); letter-spacing: -0.5px; line-height: 1.1; }
  .kpi .unit { font-size: 14px; font-weight: 500; color: var(--text-muted); margin-left: 1px; }
  .kpi .detail { font-size: 11px; color: var(--text-dim); margin-top: 3px; }

  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .card {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: var(--radius); padding: 22px; box-shadow: var(--shadow);
  }
  .card.full { grid-column: 1 / -1; }
  .card h2 { font-size: 14px; font-weight: 600; color: var(--heading); margin-bottom: 3px; }
  .card .card-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.4; }
  canvas { width: 100% !important; }

  .insight {
    border-radius: 8px; padding: 12px 16px; margin-top: 14px;
    font-size: 12px; line-height: 1.6;
  }
  .insight.info { background: var(--accent-light); color: #491d8b; }
  .insight.success { background: var(--green-light); color: #044317; }
  .insight.warn { background: var(--amber-light); color: #750e13; }
  .insight strong { font-weight: 600; }

  .heatmap-container { position: relative; overflow-x: auto; }
  .heatmap-canvas { display: block; }
  #heatmapTooltip {
    display: none; position: absolute;
    background: var(--heading); color: #fff; border-radius: 6px;
    padding: 5px 10px; font-size: 11px; pointer-events: none; z-index: 10; white-space: nowrap;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .source-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .source-table th {
    text-align: left; font-weight: 600; color: var(--text-muted); font-size: 11px;
    text-transform: uppercase; letter-spacing: 0.3px; padding: 8px 10px;
    border-bottom: 2px solid var(--card-border);
  }
  .source-table th:not(:first-child) { text-align: right; }
  .source-table td { padding: 8px 10px; border-bottom: 1px solid #f1f3f5; color: var(--text); }
  .source-table td:not(:first-child) { text-align: right; font-variant-numeric: tabular-nums; }
  .source-table tr:last-child td { border-bottom: none; }
  .source-table tr:hover { background: #f8f9fb; }
  .name-cell { display: flex; align-items: center; gap: 8px; }
  .type-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .type-dot.article { background: var(--blue); }
  .type-dot.youtube { background: var(--rose); }
  .type-dot.podcast { background: var(--violet); }
  .consistency-track {
    display: inline-block; width: 48px; height: 5px; border-radius: 3px;
    background: #f1f3f5; position: relative; vertical-align: middle; margin-right: 6px;
  }
  .consistency-bar {
    display: block; height: 100%; border-radius: 3px; background: var(--accent);
  }

  .footer { text-align: center; margin-top: 32px; font-size: 11px; color: var(--text-dim); }

  @media (max-width: 700px) {
    body { padding: 20px 16px; }
    .kpi-strip { grid-template-columns: repeat(2, 1fr); }
    .grid { grid-template-columns: 1fr; }
    .card.full { grid-column: 1; }
  }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <h1>MLS Publishing Rhythms</h1>
    <div class="meta">341 articles from 60 sources &middot; Feb 17&ndash;25, 2026 &middot; All times U.S. Central</div>
  </div>

  <div class="kpi-strip">
    <div class="kpi">
      <div class="label">Weekday Volume</div>
      <div class="value">32<span class="unit">/ day</span></div>
      <div class="detail">Peaks Monday post-match</div>
    </div>
    <div class="kpi">
      <div class="label">Weekend Volume</div>
      <div class="value">43<span class="unit">/ day</span></div>
      <div class="detail">+33% vs weekday</div>
    </div>
    <div class="kpi">
      <div class="label">Content Age at Send</div>
      <div class="value">15.5<span class="unit">hrs</span></div>
      <div class="detail">Avg at 7 AM digest</div>
    </div>
    <div class="kpi">
      <div class="label">Fresh at Send</div>
      <div class="value">13<span class="unit">%</span></div>
      <div class="detail">Under 8 hrs old</div>
    </div>
    <div class="kpi">
      <div class="label">Scheduled at :00</div>
      <div class="value">14<span class="unit">%</span></div>
      <div class="detail">Exactly on the hour</div>
    </div>
  </div>

  <div class="grid">

    <div class="card full">
      <h2>When Sources Publish</h2>
      <div class="card-desc">Average articles per hour, normalized by number of days. Dashed line = 7 AM pipeline cutoff.</div>
      <div style="height:260px"><canvas id="hourlyChart"></canvas></div>
      <div class="insight info">
        <strong>Weekday peak: noon&ndash;2 PM</strong> (3+ articles/hr), sitting ~18 hrs before reaching readers.
        <strong>Weekend peak shifts to 9&ndash;10 PM</strong> from post-match recaps.
      </div>
    </div>

    <div class="card">
      <h2>Content Freshness at Send</h2>
      <div class="card-desc">How old each article is when the 7 AM digest ships.</div>
      <div style="height:220px"><canvas id="freshnessChart"></canvas></div>
    </div>

    <div class="card">
      <h2>Pipeline Timing Trade-off</h2>
      <div class="card-desc">Average content age and freshness for each possible run time.</div>
      <div style="height:220px"><canvas id="runTimeChart"></canvas></div>
    </div>

    <div class="card full">
      <h2>On-the-Hour Scheduling</h2>
      <div class="card-desc">How publish times cluster around the top of each hour. Many CMS platforms schedule posts at exactly :00.</div>
      <div style="display:flex; gap:16px; flex-wrap:wrap;">
        <div style="flex:2; min-width:300px; height:220px;"><canvas id="minuteChart"></canvas></div>
        <div style="flex:1; min-width:260px; height:220px;"><canvas id="extraCaughtChart"></canvas></div>
      </div>
      <div class="insight success" id="scheduleInsight"></div>
    </div>

    <div class="card full">
      <h2>Publishing Heatmap</h2>
      <div class="card-desc">Average articles per hour by day of week. Hover for values.</div>
      <div class="heatmap-container">
        <canvas id="heatmapCanvas" class="heatmap-canvas"></canvas>
        <div id="heatmapTooltip"></div>
      </div>
    </div>

    <div class="card">
      <h2>Daily Volume by Type</h2>
      <div class="card-desc">Stacked by content type. Orange border = weekend.</div>
      <div style="height:220px"><canvas id="dailyChart"></canvas></div>
    </div>

    <div class="card">
      <h2>Weekend Content Shift</h2>
      <div class="card-desc">How the content mix changes on weekends vs weekdays.</div>
      <div style="height:220px"><canvas id="mixChart"></canvas></div>
    </div>

    <div class="card full">
      <h2>Top Sources</h2>
      <div class="card-desc">Ranked by volume. Consistency = active publishing days out of 8.</div>
      <table class="source-table">
        <thead><tr><th>Source</th><th>Articles</th><th>Avg Publish</th><th>Consistency</th></tr></thead>
        <tbody id="sourceTableBody"></tbody>
      </table>
    </div>

  </div>
  <div class="footer">Data from live RSS feeds &middot; pubDate normalized from RFC 2822 to U.S. Central</div>
</div>

<script>
const D = {"stats": {"total_articles": 341, "total_feeds": 61, "weekday_avg": 31.2, "weekend_avg": 45.5, "avg_freshness_hrs": 15.3, "pct_fresh_under_8h": 15, "pct_on_hour": 14, "on_hour_at_7am": 6, "on_hour_at_8am": 4, "wd_dates": 8, "we_dates": 2}, "wd_avg": [0.88, 0.0, 0.12, 0.12, 0.0, 0.62, 0.88, 1.0, 2.0, 1.62, 1.75, 2.0, 3.25, 3.12, 1.38, 2.12, 1.62, 1.62, 0.88, 1.75, 0.62, 1.12, 1.12, 1.62], "we_avg": [2.5, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.5, 3.0, 3.0, 2.5, 3.0, 2.0, 2.5, 2.0, 1.0, 3.0, 1.5, 1.0, 1.0, 2.0, 4.0, 4.0, 3.0], "freshness_pct": [0.0, 2.6, 2.1, 0.0, 0.3, 0.3, 0.6, 3.5, 5.6, 5.0, 5.0, 2.6, 4.7, 2.6, 4.7, 5.6, 5.6, 4.4, 8.8, 8.8, 6.5, 5.6, 5.6, 6.5, 3.2], "run_times": [{"avg_age": 10.5, "fresh_pct": 35.8}, {"avg_age": 10.7, "fresh_pct": 33.7}, {"avg_age": 11.6, "fresh_pct": 29.6}, {"avg_age": 12.5, "fresh_pct": 27.3}, {"avg_age": 13.4, "fresh_pct": 22.9}, {"avg_age": 14.4, "fresh_pct": 20.2}, {"avg_age": 14.9, "fresh_pct": 17.3}, {"avg_age": 15.3, "fresh_pct": 15.0}, {"avg_age": 15.5, "fresh_pct": 12.6}, {"avg_age": 15.0, "fresh_pct": 15.5}, {"avg_age": 14.6, "fresh_pct": 20.5}, {"avg_age": 14.3, "fresh_pct": 25.8}, {"avg_age": 13.8, "fresh_pct": 32.0}, {"avg_age": 12.6, "fresh_pct": 40.8}, {"avg_age": 11.5, "fresh_pct": 47.5}, {"avg_age": 11.5, "fresh_pct": 49.3}, {"avg_age": 11.1, "fresh_pct": 51.6}, {"avg_age": 10.8, "fresh_pct": 50.7}, {"avg_age": 10.7, "fresh_pct": 49.9}, {"avg_age": 11.0, "fresh_pct": 46.9}, {"avg_age": 10.9, "fresh_pct": 45.2}, {"avg_age": 11.3, "fresh_pct": 39.0}, {"avg_age": 11.1, "fresh_pct": 35.2}, {"avg_age": 10.9, "fresh_pct": 35.8}], "daily_data": [{"label": "02-17 Tue", "is_weekend": false, "article": 2, "youtube": 2, "podcast": 1, "total": 5}, {"label": "02-18 Wed", "is_weekend": false, "article": 7, "youtube": 7, "podcast": 7, "total": 21}, {"label": "02-19 Thu", "is_weekend": false, "article": 6, "youtube": 14, "podcast": 2, "total": 22}, {"label": "02-20 Fri", "is_weekend": false, "article": 29, "youtube": 10, "podcast": 8, "total": 47}, {"label": "02-21 Sat", "is_weekend": true, "article": 27, "youtube": 12, "podcast": 2, "total": 41}, {"label": "02-22 Sun", "is_weekend": true, "article": 29, "youtube": 14, "podcast": 7, "total": 50}, {"label": "02-23 Mon", "is_weekend": false, "article": 36, "youtube": 23, "podcast": 8, "total": 67}, {"label": "02-24 Tue", "is_weekend": false, "article": 7, "youtube": 21, "podcast": 5, "total": 33}, {"label": "02-25 Wed", "is_weekend": false, "article": 31, "youtube": 11, "podcast": 12, "total": 54}, {"label": "02-26 Thu", "is_weekend": false, "article": 0, "youtube": 1, "podcast": 0, "total": 1}], "heatmap": [{"d": 0, "h": 0, "v": 1.0}, {"d": 0, "h": 1, "v": 0.0}, {"d": 0, "h": 2, "v": 0.0}, {"d": 0, "h": 3, "v": 0.0}, {"d": 0, "h": 4, "v": 0.0}, {"d": 0, "h": 5, "v": 2.0}, {"d": 0, "h": 6, "v": 4.0}, {"d": 0, "h": 7, "v": 0.0}, {"d": 0, "h": 8, "v": 3.0}, {"d": 0, "h": 9, "v": 3.0}, {"d": 0, "h": 10, "v": 5.0}, {"d": 0, "h": 11, "v": 5.0}, {"d": 0, "h": 12, "v": 11.0}, {"d": 0, "h": 13, "v": 9.0}, {"d": 0, "h": 14, "v": 0.0}, {"d": 0, "h": 15, "v": 3.0}, {"d": 0, "h": 16, "v": 6.0}, {"d": 0, "h": 17, "v": 4.0}, {"d": 0, "h": 18, "v": 2.0}, {"d": 0, "h": 19, "v": 2.0}, {"d": 0, "h": 20, "v": 0.0}, {"d": 0, "h": 21, "v": 2.0}, {"d": 0, "h": 22, "v": 3.0}, {"d": 0, "h": 23, "v": 2.0}, {"d": 1, "h": 0, "v": 0.5}, {"d": 1, "h": 1, "v": 0.0}, {"d": 1, "h": 2, "v": 0.0}, {"d": 1, "h": 3, "v": 0.0}, {"d": 1, "h": 4, "v": 0.0}, {"d": 1, "h": 5, "v": 0.0}, {"d": 1, "h": 6, "v": 0.5}, {"d": 1, "h": 7, "v": 0.5}, {"d": 1, "h": 8, "v": 0.0}, {"d": 1, "h": 9, "v": 1.5}, {"d": 1, "h": 10, "v": 0.0}, {"d": 1, "h": 11, "v": 1.0}, {"d": 1, "h": 12, "v": 1.0}, {"d": 1, "h": 13, "v": 1.5}, {"d": 1, "h": 14, "v": 2.0}, {"d": 1, "h": 15, "v": 0.0}, {"d": 1, "h": 16, "v": 1.0}, {"d": 1, "h": 17, "v": 1.0}, {"d": 1, "h": 18, "v": 1.0}, {"d": 1, "h": 19, "v": 1.0}, {"d": 1, "h": 20, "v": 1.0}, {"d": 1, "h": 21, "v": 2.0}, {"d": 1, "h": 22, "v": 0.0}, {"d": 1, "h": 23, "v": 3.5}, {"d": 2, "h": 0, "v": 1.0}, {"d": 2, "h": 1, "v": 0.0}, {"d": 2, "h": 2, "v": 0.0}, {"d": 2, "h": 3, "v": 0.5}, {"d": 2, "h": 4, "v": 0.0}, {"d": 2, "h": 5, "v": 0.5}, {"d": 2, "h": 6, "v": 0.5}, {"d": 2, "h": 7, "v": 0.5}, {"d": 2, "h": 8, "v": 2.5}, {"d": 2, "h": 9, "v": 2.5}, {"d": 2, "h": 10, "v": 2.5}, {"d": 2, "h": 11, "v": 3.5}, {"d": 2, "h": 12, "v": 4.0}, {"d": 2, "h": 13, "v": 4.0}, {"d": 2, "h": 14, "v": 2.5}, {"d": 2, "h": 15, "v": 4.5}, {"d": 2, "h": 16, "v": 0.5}, {"d": 2, "h": 17, "v": 2.5}, {"d": 2, "h": 18, "v": 0.5}, {"d": 2, "h": 19, "v": 1.5}, {"d": 2, "h": 20, "v": 0.5}, {"d": 2, "h": 21, "v": 1.0}, {"d": 2, "h": 22, "v": 2.0}, {"d": 2, "h": 23, "v": 0.0}, {"d": 3, "h": 0, "v": 0.0}, {"d": 3, "h": 1, "v": 0.0}, {"d": 3, "h": 2, "v": 0.0}, {"d": 3, "h": 3, "v": 0.0}, {"d": 3, "h": 4, "v": 0.0}, {"d": 3, "h": 5, "v": 0.0}, {"d": 3, "h": 6, "v": 0.0}, {"d": 3, "h": 7, "v": 1.5}, {"d": 3, "h": 8, "v": 0.5}, {"d": 3, "h": 9, "v": 0.0}, {"d": 3, "h": 10, "v": 0.5}, {"d": 3, "h": 11, "v": 0.0}, {"d": 3, "h": 12, "v": 0.0}, {"d": 3, "h": 13, "v": 0.0}, {"d": 3, "h": 14, "v": 0.5}, {"d": 3, "h": 15, "v": 1.0}, {"d": 3, "h": 16, "v": 1.0}, {"d": 3, "h": 17, "v": 0.0}, {"d": 3, "h": 18, "v": 0.0}, {"d": 3, "h": 19, "v": 2.0}, {"d": 3, "h": 20, "v": 1.0}, {"d": 3, "h": 21, "v": 0.5}, {"d": 3, "h": 22, "v": 1.0}, {"d": 3, "h": 23, "v": 2.0}, {"d": 4, "h": 0, "v": 3.0}, {"d": 4, "h": 1, "v": 0.0}, {"d": 4, "h": 2, "v": 1.0}, {"d": 4, "h": 3, "v": 0.0}, {"d": 4, "h": 4, "v": 0.0}, {"d": 4, "h": 5, "v": 2.0}, {"d": 4, "h": 6, "v": 1.0}, {"d": 4, "h": 7, "v": 3.0}, {"d": 4, "h": 8, "v": 7.0}, {"d": 4, "h": 9, "v": 2.0}, {"d": 4, "h": 10, "v": 3.0}, {"d": 4, "h": 11, "v": 2.0}, {"d": 4, "h": 12, "v": 5.0}, {"d": 4, "h": 13, "v": 5.0}, {"d": 4, "h": 14, "v": 1.0}, {"d": 4, "h": 15, "v": 3.0}, {"d": 4, "h": 16, "v": 2.0}, {"d": 4, "h": 17, "v": 2.0}, {"d": 4, "h": 18, "v": 2.0}, {"d": 4, "h": 19, "v": 3.0}, {"d": 4, "h": 20, "v": 0.0}, {"d": 4, "h": 21, "v": 0.0}, {"d": 4, "h": 22, "v": 0.0}, {"d": 4, "h": 23, "v": 0.0}, {"d": 5, "h": 0, "v": 1.0}, {"d": 5, "h": 1, "v": 0.0}, {"d": 5, "h": 2, "v": 0.0}, {"d": 5, "h": 3, "v": 0.0}, {"d": 5, "h": 4, "v": 0.0}, {"d": 5, "h": 5, "v": 1.0}, {"d": 5, "h": 6, "v": 1.0}, {"d": 5, "h": 7, "v": 3.0}, {"d": 5, "h": 8, "v": 3.0}, {"d": 5, "h": 9, "v": 5.0}, {"d": 5, "h": 10, "v": 1.0}, {"d": 5, "h": 11, "v": 4.0}, {"d": 5, "h": 12, "v": 1.0}, {"d": 5, "h": 13, "v": 2.0}, {"d": 5, "h": 14, "v": 2.0}, {"d": 5, "h": 15, "v": 1.0}, {"d": 5, "h": 16, "v": 2.0}, {"d": 5, "h": 17, "v": 1.0}, {"d": 5, "h": 18, "v": 0.0}, {"d": 5, "h": 19, "v": 0.0}, {"d": 5, "h": 20, "v": 2.0}, {"d": 5, "h": 21, "v": 5.0}, {"d": 5, "h": 22, "v": 3.0}, {"d": 5, "h": 23, "v": 3.0}, {"d": 6, "h": 0, "v": 4.0}, {"d": 6, "h": 1, "v": 2.0}, {"d": 6, "h": 2, "v": 0.0}, {"d": 6, "h": 3, "v": 0.0}, {"d": 6, "h": 4, "v": 0.0}, {"d": 6, "h": 5, "v": 1.0}, {"d": 6, "h": 6, "v": 1.0}, {"d": 6, "h": 7, "v": 0.0}, {"d": 6, "h": 8, "v": 3.0}, {"d": 6, "h": 9, "v": 1.0}, {"d": 6, "h": 10, "v": 4.0}, {"d": 6, "h": 11, "v": 2.0}, {"d": 6, "h": 12, "v": 3.0}, {"d": 6, "h": 13, "v": 3.0}, {"d": 6, "h": 14, "v": 2.0}, {"d": 6, "h": 15, "v": 1.0}, {"d": 6, "h": 16, "v": 4.0}, {"d": 6, "h": 17, "v": 2.0}, {"d": 6, "h": 18, "v": 2.0}, {"d": 6, "h": 19, "v": 2.0}, {"d": 6, "h": 20, "v": 2.0}, {"d": 6, "h": 21, "v": 3.0}, {"d": 6, "h": 22, "v": 5.0}, {"d": 6, "h": 23, "v": 3.0}], "day_names": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"], "top_sources": [{"name": "Soccer Down Here (ATL)", "total": 17, "type": "podcast", "active_days": 5, "total_days": 8, "avg_hour": 13.0}, {"name": "San Diego Futbol (SD)", "total": 16, "type": "youtube", "active_days": 7, "total_days": 8, "avg_hour": 10.4}, {"name": "MLS Official", "total": 15, "type": "youtube", "active_days": 3, "total_days": 8, "avg_hour": 12.5}, {"name": "Soccerwise", "total": 15, "type": "youtube", "active_days": 4, "total_days": 8, "avg_hour": 16.1}, {"name": "Total Soccer Show", "total": 15, "type": "youtube", "active_days": 8, "total_days": 8, "avg_hour": 10.8}, {"name": "The Designated Players", "total": 15, "type": "youtube", "active_days": 5, "total_days": 8, "avg_hour": 14.1}, {"name": "NY Post - Christian Arnold", "total": 15, "type": "article", "active_days": 4, "total_days": 8, "avg_hour": 18.7}, {"name": "Bayou City Soccer (HOU)", "total": 12, "type": "article", "active_days": 5, "total_days": 8, "avg_hour": 12.8}, {"name": "The Cooligans", "total": 11, "type": "youtube", "active_days": 5, "total_days": 8, "avg_hour": 14.7}, {"name": "3rd Degree (DAL)", "total": 10, "type": "article", "active_days": 5, "total_days": 8, "avg_hour": 12.0}, {"name": "The Ball is Round (MTL)", "total": 10, "type": "youtube", "active_days": 5, "total_days": 8, "avg_hour": 9.5}, {"name": "Fox Sports", "total": 9, "type": "article", "active_days": 6, "total_days": 8, "avg_hour": 13.4}, {"name": "Burgundy Wave (COL)", "total": 9, "type": "article", "active_days": 5, "total_days": 8, "avg_hour": 12.9}, {"name": "Philadelphia Soccer Now (PHI)", "total": 9, "type": "article", "active_days": 3, "total_days": 8, "avg_hour": 15.1}, {"name": "KC Soccer Journal (SKC)", "total": 9, "type": "article", "active_days": 5, "total_days": 8, "avg_hour": 13.4}], "content_mix": {"article": {"weekday_avg": 14.8, "weekend_avg": 28.0}, "youtube": {"weekday_avg": 11.1, "weekend_avg": 13.0}, "podcast": {"weekday_avg": 5.4, "weekend_avg": 4.5}}, "minute_dist": [47, 8, 7, 4, 5, 9, 7, 6, 6, 2, 3, 4, 7, 2, 4, 12, 4, 4, 5, 5, 5, 4, 8, 6, 5, 4, 4, 6, 4, 4, 21, 0, 3, 0, 7, 3, 4, 6, 3, 4, 3, 3, 3, 5, 4, 2, 5, 6, 4, 5, 2, 7, 1, 3, 3, 6, 6, 2, 13, 6], "on_hour_by_hour": {"0": {"total": 12, "on_hour": 0, "first_5min": 1}, "1": {"total": 2, "on_hour": 0, "first_5min": 1}, "2": {"total": 1, "on_hour": 1, "first_5min": 1}, "3": {"total": 1, "on_hour": 1, "first_5min": 1}, "4": {"total": 0, "on_hour": 0, "first_5min": 0}, "5": {"total": 7, "on_hour": 3, "first_5min": 3}, "6": {"total": 9, "on_hour": 0, "first_5min": 2}, "7": {"total": 11, "on_hour": 6, "first_5min": 6}, "8": {"total": 22, "on_hour": 4, "first_5min": 6}, "9": {"total": 19, "on_hour": 2, "first_5min": 5}, "10": {"total": 19, "on_hour": 7, "first_5min": 7}, "11": {"total": 22, "on_hour": 2, "first_5min": 3}, "12": {"total": 30, "on_hour": 4, "first_5min": 5}, "13": {"total": 30, "on_hour": 4, "first_5min": 6}, "14": {"total": 15, "on_hour": 3, "first_5min": 3}, "15": {"total": 19, "on_hour": 1, "first_5min": 6}, "16": {"total": 19, "on_hour": 1, "first_5min": 1}, "17": {"total": 16, "on_hour": 1, "first_5min": 4}, "18": {"total": 9, "on_hour": 3, "first_5min": 3}, "19": {"total": 16, "on_hour": 1, "first_5min": 2}, "20": {"total": 9, "on_hour": 0, "first_5min": 1}, "21": {"total": 17, "on_hour": 1, "first_5min": 2}, "22": {"total": 17, "on_hour": 0, "first_5min": 0}, "23": {"total": 19, "on_hour": 2, "first_5min": 2}}, "schedule_analysis": [{"hour": 5, "extra_caught": 3, "total_at_hour": 7}, {"hour": 6, "extra_caught": 2, "total_at_hour": 9}, {"hour": 7, "extra_caught": 6, "total_at_hour": 11}, {"hour": 8, "extra_caught": 6, "total_at_hour": 22}, {"hour": 9, "extra_caught": 5, "total_at_hour": 19}, {"hour": 10, "extra_caught": 7, "total_at_hour": 19}, {"hour": 11, "extra_caught": 3, "total_at_hour": 22}, {"hour": 12, "extra_caught": 5, "total_at_hour": 30}]};

Chart.defaults.color = '#7c8694';
Chart.defaults.borderColor = '#e8eaef';
Chart.defaults.font.family = "Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.padding = 14;
Chart.defaults.plugins.legend.labels.boxWidth = 8;
Chart.defaults.animation = { duration: 500, easing: 'easeOutQuart' };

const ttStyle = { backgroundColor:'#1a2332', titleColor:'#fff', bodyColor:'#e2e8f0', padding:10, cornerRadius:8, borderWidth:0 };
const hourLabel = i => { const h = i%12||12; return h+(i>=12?'pm':'am'); };
const hourLabels = Array.from({length:24},(_,i)=>hourLabel(i));
const gridColor = 'rgba(0,0,0,0.04)';

/* 1. Hourly curve */
new Chart(document.getElementById('hourlyChart'), {
  type:'line',
  data:{
    labels:hourLabels,
    datasets:[
      { label:'Weekday', data:D.wd_avg, borderColor:'#1192e8', backgroundColor:'rgba(17,146,232,0.07)', fill:true, tension:.4, pointRadius:0, pointHoverRadius:5, pointHoverBackgroundColor:'#1192e8', borderWidth:2.5 },
      { label:'Weekend', data:D.we_avg, borderColor:'#fa4d56', backgroundColor:'rgba(250,77,86,0.06)', fill:true, tension:.4, pointRadius:0, pointHoverRadius:5, pointHoverBackgroundColor:'#fa4d56', borderWidth:2.5 }
    ]
  },
  options:{
    responsive:true, maintainAspectRatio:false,
    interaction:{mode:'index',intersect:false},
    plugins:{
      legend:{position:'top',align:'end'},
      tooltip:{...ttStyle, callbacks:{label:ctx=>`${ctx.dataset.label}: ${ctx.parsed.y.toFixed(1)} avg/day`}},
      annotation:{annotations:{cutoff:{type:'line',xMin:7,xMax:7,borderColor:'rgba(159,24,83,0.5)',borderWidth:1.5,borderDash:[5,3],label:{display:true,content:'7 AM pipeline',position:'end',color:'rgba(159,24,83,0.7)',font:{size:10,weight:400},backgroundColor:'transparent'}}}}
    },
    scales:{
      y:{beginAtZero:true,grid:{color:gridColor},ticks:{stepSize:1},title:{display:true,text:'articles / day',color:'#a1aab5',font:{size:10}}},
      x:{grid:{display:false}}
    }
  }
});

/* 2. Freshness */
(()=>{
  const colors = D.freshness_pct.map((_,i)=> i<=8?'#198038':i<=16?'#1192e8':'#fa4d56');
  new Chart(document.getElementById('freshnessChart'),{
    type:'bar',
    data:{labels:D.freshness_pct.map((_,i)=>i+'h'),datasets:[{data:D.freshness_pct,backgroundColor:colors.map(c=>c+'99'),borderColor:colors,borderWidth:1,borderRadius:2,barPercentage:1,categoryPercentage:.92}]},
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{...ttStyle,callbacks:{label:ctx=>`${ctx.parsed.y.toFixed(1)}% of articles`}}},
      scales:{
        y:{beginAtZero:true,grid:{color:gridColor},title:{display:true,text:'% of articles',color:'#a1aab5',font:{size:10}},ticks:{callback:v=>v+'%'}},
        x:{grid:{display:false},ticks:{maxRotation:0,autoSkip:true,maxTicksLimit:12},title:{display:true,text:'age when digest sends',color:'#a1aab5',font:{size:10}}}
      }
    }
  });
})();

/* 3. Run time trade-off */
(()=>{
  new Chart(document.getElementById('runTimeChart'),{
    type:'line',
    data:{
      labels:hourLabels,
      datasets:[
        {label:'Avg age (hrs)',data:D.run_times.map(r=>r.avg_age),borderColor:'#1192e8',backgroundColor:'transparent',tension:.4,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:'#1192e8',borderWidth:2.5,yAxisID:'y'},
        {label:'% under 8h old',data:D.run_times.map(r=>r.fresh_pct),borderColor:'#198038',backgroundColor:'transparent',tension:.4,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:'#198038',borderWidth:2,borderDash:[4,3],yAxisID:'y1'}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      interaction:{mode:'index',intersect:false},
      plugins:{
        legend:{position:'top',align:'end'},
        tooltip:{...ttStyle,callbacks:{title:items=>`Run at ${items[0].label}`,afterBody:items=>items[0].dataIndex===7?'  \u2190 current schedule':''}},
        annotation:{annotations:{
          dot:{type:'point',xValue:7,yValue:D.run_times[7].avg_age,backgroundColor:'#9f1853',radius:5,borderColor:'#fff',borderWidth:2},
          lbl:{type:'label',xValue:7.5,yValue:D.run_times[7].avg_age+.6,content:'current',color:'#9f1853',font:{size:9,weight:600},backgroundColor:'transparent'}
        }}
      },
      scales:{
        y:{beginAtZero:false,grid:{color:gridColor},title:{display:true,text:'avg age (hrs)',color:'#a1aab5',font:{size:10}},reverse:true},
        y1:{position:'right',beginAtZero:true,grid:{display:false},title:{display:true,text:'% fresh',color:'#a1aab5',font:{size:10}},ticks:{callback:v=>v+'%'}},
        x:{grid:{display:false}}
      }
    }
  });
})();

/* 4. Minute distribution + extra caught */
(()=>{
  const mLabels = D.minute_dist.map((_,i)=>':'+String(i).padStart(2,'0'));
  const mColors = D.minute_dist.map((_,i)=> i===0?'#6929c4': i<5?'#a56eff': i%15===0?'#d4bbff':'#dde1e6');
  new Chart(document.getElementById('minuteChart'),{
    type:'bar',
    data:{labels:mLabels,datasets:[{data:D.minute_dist,backgroundColor:mColors.map(c=>c+'cc'),borderColor:mColors,borderWidth:1,borderRadius:1,barPercentage:1,categoryPercentage:1}]},
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{...ttStyle,callbacks:{title:items=>`Published at ${items[0].label} past the hour`,label:ctx=>`${ctx.parsed.y} articles (${(ctx.parsed.y/D.stats.total_articles*100).toFixed(1)}%)`}}},
      scales:{
        y:{beginAtZero:true,grid:{color:gridColor},title:{display:true,text:'articles',color:'#a1aab5',font:{size:10}}},
        x:{grid:{display:false},ticks:{maxRotation:0,autoSkip:true,maxTicksLimit:12}}
      }
    }
  });

  // Extra caught chart
  const sa = D.schedule_analysis;
  const saLabels = sa.map(s=>hourLabel(s.hour));
  new Chart(document.getElementById('extraCaughtChart'),{
    type:'bar',
    data:{
      labels:saLabels,
      datasets:[
        {label:'Extra at :05',data:sa.map(s=>s.extra_caught),backgroundColor:'#19803899',borderColor:'#198038',borderWidth:1,borderRadius:3},
        {label:'Rest of hour',data:sa.map(s=>s.total_at_hour-s.extra_caught),backgroundColor:'#e8eaef',borderColor:'#c6c6c6',borderWidth:1,borderRadius:3}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{
        legend:{position:'top',align:'end'},
        tooltip:{...ttStyle,callbacks:{afterBody:items=>{const i=items[0].dataIndex;const s=sa[i];return `Running at ${saLabels[i].replace(/[ap]m/,':05$&')} catches ${s.extra_caught} extra`}}},
        annotation:{annotations:{
          cur:{type:'line',xMin:2,xMax:2,borderColor:'rgba(159,24,83,0.4)',borderWidth:1.5,borderDash:[4,3],label:{display:true,content:'current',position:'start',color:'#9f1853',font:{size:9},backgroundColor:'transparent'}}
        }}
      },
      scales:{x:{stacked:true,grid:{display:false}},y:{stacked:true,beginAtZero:true,grid:{color:gridColor},title:{display:true,text:'articles at this hour',color:'#a1aab5',font:{size:10}}}}
    }
  });

  // Insight text
  const at7 = sa.find(s=>s.hour===7);
  const at8 = sa.find(s=>s.hour===8);
  document.getElementById('scheduleInsight').innerHTML = `
    <strong>${D.stats.pct_on_hour}% of articles publish at exactly :00</strong> \u2014 a clear CMS scheduling pattern. At 7 AM, ${at7.extra_caught} of ${at7.total_at_hour} articles land in the first 5 minutes.
    Moving to <strong>8:05 AM</strong> would capture those ${at7.extra_caught} (which currently just miss the cutoff) plus ${at8.extra_caught} articles scheduled at 8:00 \u2014 <strong>${at7.extra_caught + at8.extra_caught} more articles per day</strong>.
    The trade-off: readers get the email ~1 hour later.
  `;
})();

/* 5. Heatmap */
(()=>{
  const canvas=document.getElementById('heatmapCanvas');
  const tooltip=document.getElementById('heatmapTooltip');
  const days=D.day_names, hours=24;
  const cellW=38,cellH=28,padL=40,padT=22,padR=12,padB=24,gap=2;
  const W=padL+hours*(cellW+gap)+padR, H=padT+7*(cellH+gap)+padB;
  const dpr=window.devicePixelRatio||1;
  canvas.width=W*dpr;canvas.height=H*dpr;
  canvas.style.width=W+'px';canvas.style.height=H+'px';
  const ctx=canvas.getContext('2d');ctx.scale(dpr,dpr);
  const maxV=Math.max(...D.heatmap.map(c=>c.v));
  const cells=[];
  ctx.fillStyle='#f8f9fb';ctx.fillRect(0,0,W,H);

  ctx.font='500 10px Inter,system-ui,sans-serif';ctx.fillStyle='#7c8694';ctx.textAlign='right';ctx.textBaseline='middle';
  days.forEach((day,i)=>{ctx.fillText(day,padL-8,padT+i*(cellH+gap)+cellH/2);});
  ctx.textAlign='center';ctx.textBaseline='top';
  for(let h=0;h<24;h+=2) ctx.fillText(hourLabel(h),padL+h*(cellW+gap)+cellW/2,padT+7*(cellH+gap)+6);

  D.heatmap.forEach(c=>{
    const x=padL+c.h*(cellW+gap), y=padT+c.d*(cellH+gap);
    const t=maxV>0?c.v/maxV:0;
    let bg;
    if(c.v===0) bg='#f2f4f8';
    else if(t<.25) bg=`rgba(0,93,93,${.06+t*.18})`;
    else if(t<.5) bg=`rgba(0,93,93,${.15+t*.3})`;
    else if(t<.75) bg=`rgba(0,93,93,${.3+t*.35})`;
    else bg=`rgba(0,93,93,${.55+t*.4})`;
    ctx.fillStyle=bg;ctx.beginPath();ctx.roundRect(x,y,cellW,cellH,4);ctx.fill();
    ctx.fillStyle=t>.45?'#fff':'#334155';
    ctx.font=(t>.45?'600 ':'')+'10px Inter,system-ui,sans-serif';ctx.textAlign='center';ctx.textBaseline='middle';
    if(c.v>0) ctx.fillText(c.v,x+cellW/2,y+cellH/2);
    cells.push({x,y,w:cellW,h:cellH,day:days[c.d],hour:hourLabel(c.h),v:c.v});
  });

  const cutX=padL+7*(cellW+gap)+cellW/2;
  ctx.strokeStyle='rgba(159,24,83,0.45)';ctx.lineWidth=1.5;ctx.setLineDash([4,3]);
  ctx.beginPath();ctx.moveTo(cutX,padT-4);ctx.lineTo(cutX,padT+7*(cellH+gap)-gap);ctx.stroke();ctx.setLineDash([]);

  canvas.addEventListener('mousemove',e=>{
    const rect=canvas.getBoundingClientRect();
    const mx=e.clientX-rect.left, my=e.clientY-rect.top;
    const hit=cells.find(c=>mx>=c.x&&mx<=c.x+c.w&&my>=c.y&&my<=c.y+c.h);
    if(hit){tooltip.style.display='block';tooltip.style.left=(hit.x+hit.w+8)+'px';tooltip.style.top=(hit.y-4)+'px';tooltip.innerHTML=`<strong>${hit.day} ${hit.hour}</strong> &mdash; ${hit.v} avg`;}
    else tooltip.style.display='none';
  });
  canvas.addEventListener('mouseleave',()=>{tooltip.style.display='none';});
})();

/* 6. Daily volume */
(()=>{
  new Chart(document.getElementById('dailyChart'),{
    type:'bar',
    data:{
      labels:D.daily_data.map(d=>d.label),
      datasets:[
        {label:'Articles',data:D.daily_data.map(d=>d.article),backgroundColor:'#1192e899',borderColor:'#1192e8',borderWidth:1,borderRadius:2},
        {label:'YouTube',data:D.daily_data.map(d=>d.youtube),backgroundColor:'#fa4d5688',borderColor:'#fa4d56',borderWidth:1,borderRadius:2},
        {label:'Podcasts',data:D.daily_data.map(d=>d.podcast),backgroundColor:'#6929c488',borderColor:'#6929c4',borderWidth:1,borderRadius:2}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{position:'top',align:'end'},tooltip:ttStyle},
      scales:{x:{stacked:true,grid:{display:false},ticks:{maxRotation:45,font:{size:10}}},y:{stacked:true,beginAtZero:true,grid:{color:gridColor}}}
    }
  });
})();

/* 7. Content mix */
(()=>{
  const types=['article','youtube','podcast'], labels=['Articles','YouTube','Podcasts'];
  const colors=['#1192e8','#fa4d56','#6929c4'];
  new Chart(document.getElementById('mixChart'),{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Weekday avg/day',data:types.map(t=>D.content_mix[t].weekday_avg),backgroundColor:colors.map(c=>c+'cc'),borderColor:colors,borderWidth:1.5,borderRadius:4,barPercentage:.45},
        {label:'Weekend avg/day',data:types.map(t=>D.content_mix[t].weekend_avg),backgroundColor:colors.map(c=>c+'44'),borderColor:colors,borderWidth:1.5,borderDash:[3,2],borderRadius:4,barPercentage:.45}
      ]
    },
    options:{
      responsive:true,maintainAspectRatio:false,
      plugins:{legend:{position:'top',align:'end'},tooltip:{...ttStyle,callbacks:{
        label:ctx=>`${ctx.dataset.label}: ${ctx.parsed.y}/day`,
        afterBody:items=>{const i=items[0].dataIndex;const t=types[i];const wd=D.content_mix[t].weekday_avg;const we=D.content_mix[t].weekend_avg;const pct=wd>0?Math.round((we-wd)/wd*100):0;return pct?`  Weekend is ${pct>0?'+':''}${pct}%`:'';}
      }}},
      scales:{y:{beginAtZero:true,grid:{color:gridColor},title:{display:true,text:'avg / day',color:'#a1aab5',font:{size:10}}},x:{grid:{display:false}}}
    }
  });
})();

/* 8. Source table */
(()=>{
  const tbody=document.getElementById('sourceTableBody');
  D.top_sources.forEach(s=>{
    const ampm=hourLabel(Math.round(s.avg_hour));
    const pct=Math.round(s.active_days/s.total_days*100);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><div class="name-cell"><span class="type-dot ${s.type}"></span>${s.name}</div></td><td>${s.total}</td><td>${ampm}</td><td><span class="consistency-track"><span class="consistency-bar" style="width:${pct}%"></span></span>${s.active_days}/${s.total_days}</td>`;
    tbody.appendChild(tr);
  });
})();
</script>
</body>
</html>
